{
  "version": "2.0_phase1",
  "last_updated": "2025-10-21T03:15:57.561377",
  "updated_by": "claude_gap_analysis_auto",
  "description": "Phase 1: Enhanced for trend holding with tiered entries and dynamic exits",
  "ribbon_state_thresholds": {
    "all_green": 0.92,
    "strong_green": 0.75,
    "weak_green": 0.5,
    "mixed": 0.33,
    "all_red": 0.92,
    "strong_red": 0.75,
    "weak_red": 0.5
  },
  "entry_rules": {
    "ribbon_alignment_threshold": 0.95,
    "min_light_emas_required": 30,
    "ribbon_states_allowed_long": [
      "all_green",
      "strong_green"
    ],
    "ribbon_states_allowed_short": [
      "all_red",
      "strong_red"
    ],
    "fresh_transition_max_minutes": 15,
    "stale_transition_min_minutes": 30,
    "entry_tiers": {
      "tier_1_strong_trend": {
        "enabled": true,
        "description": "Strong trending conditions - hold aggressively",
        "ribbon_states_long": [
          "all_green"
        ],
        "ribbon_states_short": [
          "all_red"
        ],
        "min_light_emas": 12,
        "min_ribbon_stability_minutes": 5,
        "entry_confidence_base": 0.85,
        "timeframe_alignment_required": false
      },
      "tier_2_moderate_trend": {
        "enabled": true,
        "description": "Moderate trending conditions - normal holds",
        "ribbon_states_long": [
          "all_green",
          "strong_green"
        ],
        "ribbon_states_short": [
          "all_red",
          "strong_red"
        ],
        "min_light_emas": 12,
        "min_ribbon_stability_minutes": 3,
        "entry_confidence_base": 0.75,
        "timeframe_alignment_required": false
      },
      "tier_3_quick_scalp": {
        "enabled": false,
        "description": "Weak/choppy conditions - quick scalps only (DISABLED for now)",
        "ribbon_states_long": [
          "weak_green"
        ],
        "ribbon_states_short": [
          "weak_red"
        ],
        "min_light_emas": 12,
        "min_ribbon_stability_minutes": 1,
        "entry_confidence_base": 0.6,
        "timeframe_alignment_required": true
      }
    },
    "min_compression_for_entry": 0.02
  },
  "exit_rules": {
    "max_hold_minutes": 90,
    "tier_1_strong_trend": {
      "description": "Exit rules for strong trend entries (all_green/all_red with 11+ light EMAs)",
      "min_hold_minutes": 20,
      "profit_target_pct": 0.021599999999999998,
      "stop_loss_pct": 0.006,
      "exit_on_ribbon_flip": false,
      "exit_on_opposite_strong_state": true,
      "exit_on_weak_state": true,
      "use_yellow_ema_trail": true,
      "trailing_ema": 60,
      "trailing_buffer_pct": 0.012,
      "min_light_emas_to_hold": 8
    },
    "tier_2_moderate_trend": {
      "description": "Exit rules for moderate trend entries (strong_green/strong_red with 8+ light EMAs)",
      "min_hold_minutes": 12,
      "profit_target_pct": 0.018,
      "stop_loss_pct": 0.005,
      "exit_on_ribbon_flip": false,
      "exit_on_opposite_state": true,
      "exit_on_weak_state": true,
      "use_yellow_ema_trail": true,
      "trailing_ema": 30,
      "trailing_buffer_pct": 0.012,
      "min_light_emas_to_hold": 6
    },
    "tier_3_quick_scalp": {
      "description": "Exit rules for quick scalp entries (weak conditions)",
      "min_hold_minutes": 6,
      "profit_target_pct": 0.009,
      "stop_loss_pct": 0.003,
      "exit_on_ribbon_flip": true,
      "exit_on_any_state_change": true,
      "use_yellow_ema_trail": true,
      "trailing_ema": 15,
      "trailing_buffer_pct": 0.006,
      "min_light_emas_to_hold": 4
    },
    "min_hold_time_minutes": 20,
    "exit_on_ribbon_flip": false,
    "exit_on_target_only": false,
    "profit_target_pct": 0.018,
    "use_yellow_ema_trail": true,
    "yellow_ema_trail_buffer_pct": 0.012
  },
  "trend_strength_analysis": {
    "enabled": true,
    "description": "Calculate trend strength score to validate entries and exits",
    "light_ema_ratio_weight": 25,
    "ema_spread_weight": 20,
    "ribbon_stability_weight": 20,
    "slope_alignment_weight": 20,
    "price_conviction_weight": 15,
    "thresholds": {
      "strong_trend": 70,
      "moderate_trend": 50,
      "weak_trend": 30
    },
    "ema_spread_thresholds": {
      "expanding": 0.003,
      "stable": 0.001,
      "compressing": 0.0005
    },
    "ribbon_stability_thresholds": {
      "very_stable": 20,
      "stable": 10,
      "unstable": 5
    }
  },
  "choppy_market_detection": {
    "enabled": true,
    "description": "Detect and avoid choppy/ranging market conditions",
    "flip_count_30min_threshold": 5,
    "ema_compression_threshold": 0.0005,
    "light_ema_changes_5min_threshold": 6,
    "avoid_entry_choppy_score": 70,
    "exit_if_choppy_score": 60
  },
  "pattern_rules": {
    "path_e_dark_transition": {
      "enabled": true,
      "priority": 2,
      "confidence_boost": 0.15,
      "entry_window_seconds": 10
    },
    "path_d_early_reversal": {
      "enabled": true,
      "priority": 4,
      "min_light_emas_opposite": 8,
      "min_green_appearing": 2,
      "confidence_threshold": 0.75
    },
    "path_c_wick_reversal": {
      "enabled": true,
      "priority": 3,
      "min_wick_pct": 0.003,
      "max_wick_pct": 0.008,
      "confidence_boost": 0.2
    },
    "path_a_trending": {
      "enabled": true,
      "priority": 5,
      "min_range_pct": 0.005,
      "price_location_lower_pct": 0.5,
      "price_location_upper_pct": 0.5,
      "min_alignment_pct": 0.85
    },
    "path_b_breakout": {
      "enabled": true,
      "priority": 6,
      "max_range_pct": 0.004,
      "min_breakout_pct": 0.0015,
      "ribbon_flip_max_minutes": 8
    },
    "path_f_momentum_surge": {
      "enabled": true,
      "priority": 1,
      "min_light_emas": 25,
      "ignore_all_other_filters": true,
      "confidence_boost": 0.9,
      "special_profit_target_pct": 0.008,
      "entry_window_seconds": 300,
      "upward_bias_multiplier": 1.5
    }
  },
  "performance_metrics": {
    "total_trades_executed": 0,
    "winning_trades": 0,
    "losing_trades": 0,
    "win_rate": 0.0,
    "avg_winner_pnl_pct": 0.0,
    "avg_loser_pnl_pct": 0.0,
    "best_pattern": "unknown",
    "worst_pattern": "unknown",
    "tier_1_trades": 0,
    "tier_2_trades": 0,
    "tier_3_trades": 0,
    "tier_1_avg_hold_minutes": 0,
    "tier_2_avg_hold_minutes": 0,
    "tier_3_avg_hold_minutes": 0
  },
  "claude_insights": {
    "last_optimization": "2025-10-21T03:15:57.561363",
    "key_findings": [
      "Finding 1: CATASTROPHIC EXECUTION FAILURE - 0.0 minute average hold time with NaN PnL indicates trades are being opened and immediately closed, suggesting broken exit logic or parameter validation errors",
      "Finding 2: MASSIVE OVER-TRADING - 4903 backtest trades vs 139 optimal trades (3527% excess) shows entry filters are completely ineffective, taking every minor ribbon fluctuation instead of selective quality setups",
      "Finding 3: INSTANT EXIT BUG - Despite minimum hold times of 15+ minutes in rules, actual hold time is 0.0 minutes, indicating exit conditions are overriding minimum holds immediately upon entry",
      "Finding 4: CONFLICTING EXIT CONDITIONS - Multiple simultaneous exit triggers (exit_on_opposite_strong_state, exit_on_weak_state, ribbon_flip) are creating immediate exits that bypass all hold logic",
      "Finding 5: ENTRY SELECTIVITY CRISIS - Current rules allow both all_green AND strong_green states with only 0.95 alignment threshold, capturing far too many marginal setups vs optimal's selective 139 trades"
    ],
    "pattern_recommendations": [
      "EMERGENCY: Fix bot execution by investigating parameter validation errors, rule parsing failures, or connectivity issues preventing any actual trades",
      "DRASTICALLY REDUCE TRADE FREQUENCY: Tighten entry filters by 80% to match optimal selectivity - require perfect ribbon alignment (all_green/all_red only) with 28+ light EMAs",
      "IMPLEMENT BIG MOVEMENT DETECTION: Add special momentum surge detection to catch the high-profit opportunities we're missing from the optimal trades",
      "ENFORCE MINIMUM HOLDS: Make minimum hold times override ALL exit conditions except stop losses to prevent instant exits",
      "SIMPLIFY EXIT LOGIC: Disable all conflicting exit conditions and focus only on profit targets, stop losses, and minimum hold enforcement"
    ],
    "rule_adjustments": {
      "ribbon_alignment_threshold": 0.95,
      "min_light_emas_required": 28,
      "max_hold_minutes": 90,
      "entry_rules": {
        "ribbon_states_allowed_long": [
          "all_green"
        ],
        "ribbon_states_allowed_short": [
          "all_red"
        ],
        "min_compression_for_entry": 0.015,
        "fresh_transition_max_minutes": 5,
        "NEW_big_movement_detection": {
          "enabled": true,
          "min_price_move_pct": 0.008,
          "volume_surge_threshold": 2.0,
          "ignore_stale_on_big_move": true
        },
        "NEW_momentum_filters": {
          "min_ema_spread_pct": 0.006,
          "dark_to_light_transition_boost": 0.4
        }
      },
      "exit_rules": {
        "tier_1_strong_trend": {
          "min_hold_minutes": 25,
          "profit_target_pct": 0.02,
          "stop_loss_pct": 0.008,
          "exit_on_ribbon_flip": false,
          "exit_on_opposite_strong_state": false,
          "exit_on_weak_state": false,
          "min_hold_override_all_exits": true
        },
        "tier_2_moderate_trend": {
          "enabled": false
        },
        "tier_3_quick_scalp": {
          "enabled": false
        }
      },
      "pattern_rules": {
        "NEW_path_f_momentum_surge": {
          "enabled": true,
          "priority": 1,
          "min_light_emas": 30,
          "ignore_all_other_filters": true,
          "confidence_boost": 0.95,
          "special_profit_target_pct": 0.025,
          "entry_window_seconds": 120
        },
        "NEW_big_movement_priority": {
          "enabled": true,
          "entry_overrides": {
            "ignore_stale_filter": true,
            "ignore_position_location_filter": true
          }
        }
      },
      "path_priorities": {
        "NEW_path_f_momentum_surge": 1,
        "path_e_dark_transition": 2,
        "path_c_wick_reversal": 3,
        "path_d_early_reversal": 4,
        "path_a_trending": 5,
        "path_b_breakout": 6
      }
    },
    "reasoning": "The data reveals a complete system breakdown requiring emergency intervention. With zero actual trades despite 4903 backtest signals, the bot execution is completely broken. The 3527% over-trading rate shows we're taking every minor ribbon change instead of the selective quality setups that generated 139 optimal trades with +1.69% PnL. The NaN PnL values and instant exits indicate exit logic is catastrophically broken. Solution: Dramatically tighten entry selectivity (only perfect all_green/all_red with 28+ light EMAs), add big movement detection to catch momentum surges we're missing, enforce minimum holds by overriding all other exits, and disable all conflicting exit conditions. This should reduce trade frequency by 80% while capturing the high-profit patterns that represent the optimal trades."
  }
}